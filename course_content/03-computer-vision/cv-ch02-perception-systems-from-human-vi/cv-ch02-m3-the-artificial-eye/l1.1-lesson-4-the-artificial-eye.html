?<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Artificial Eye - Camera Basics</title>
    <style>
* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #2d3748;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }



        /* Main Container */
        .lesson-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Section Cards */
        section {
            background: transparent;
            margin-bottom: 30px;
            padding: 20px 0;
            display: none;
            opacity: 0;
            transition: all 0.6s ease;
            transform: translateY(20px);
        }

        section.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 1rem;
        }

        p {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 1.5rem;
        }

        ul {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        li {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #4a5568;
            margin-bottom: 0.5rem;
        }

        strong {
            color: #2d3748;
            font-weight: 600;
        }

        em {
            color: #667eea;
            font-style: normal;
            font-weight: 500;
        }

        /* Image Placeholders */
        .image-placeholder {
            margin: 2rem 0;
        }

        /* Confetti Animation */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            font-size: 20px;
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti:nth-child(odd) {
            animation-duration: 2.5s;
            animation-delay: 0.2s;
        }

        .confetti:nth-child(even) {
            animation-duration: 3.5s;
            animation-delay: 0.5s;
        }

        .confetti:nth-child(3n) {
            animation-duration: 2.8s;
            animation-delay: 0.8s;
        }

        .confetti:nth-child(4n) {
            animation-duration: 3.2s;
            animation-delay: 0.3s;
        }

        .confetti:nth-child(5n) {
            animation-duration: 2.7s;
            animation-delay: 0.7s;
        }

        /* Success Message Animation */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
            z-index: 10000;
            opacity: 0;
            animation: success-popup 2.5s ease-out;
            pointer-events: none;
        }

        @keyframes success-popup {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
            40% {
                transform: translate(-50%, -50%) scale(1);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        }

        .image-placeholder img {
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        /* Specific sizing for individual images by section */
        #section1 .image-placeholder img {
            width: 70% !important;              /* Image 1: 70% (dramatic light beam) */
            max-width: 500px !important;
        }

        #section6 .image-placeholder img {
            width: 55% !important;              /* Image 2: 50-60% (meme image) */
            max-width: 400px !important;
        }
        
        #section9 .image-placeholder img {
            width: 85% !important;              /* Image 3: 80-90% (prism diagram) */
            max-width: 600px !important;
        }
        
        #section13 .image-placeholder img {
            width: 85% !important;              /* Image 4: 80-90% (red object) */
            max-width: 600px !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            #section1 .image-placeholder img {
                width: 80% !important;
                max-width: 400px !important;
            }

            #section6 .image-placeholder img {
                width: 65% !important;
                max-width: 350px !important;
            }
            
            #section9 .image-placeholder img,
            #section13 .image-placeholder img {
                width: 90% !important;
                max-width: 450px !important;
            }
        }
        
        @media (max-width: 480px) {
            #section1 .image-placeholder img {
                width: 85% !important;
                max-width: 300px !important;
            }

            #section6 .image-placeholder img {
                width: 75% !important;
                max-width: 280px !important;
            }
            
            #section9 .image-placeholder img,
            #section13 .image-placeholder img {
                width: 95% !important;
                max-width: 320px !important;
            }
        }

        /* Content Boxes */
        .vocab-section, .why-it-matters, .test-your-knowledge, .faq-section, 
        .stop-and-think, .check-your-knowledge {
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .vocab-section::before, .why-it-matters::before, .test-your-knowledge::before,
        .faq-section::before, .stop-and-think::before, .check-your-knowledge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.05;
            z-index: 0;
        }

        .vocab-section {
            background: linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%);
            border-left-color: #4facfe;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.1);
        }

        .vocab-section::before {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
        }

        .why-it-matters {
            background: linear-gradient(135deg, #ffeef7 0%, #fff0f8 100%);
            border-left-color: #f093fb;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.1);
        }

        .why-it-matters::before {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }

        .test-your-knowledge, .check-your-knowledge {
            background: linear-gradient(135deg, #eafaf1 0%, #f0fcf4 100%);
            border-left-color: #68d391;
            box-shadow: 0 10px 30px rgba(104, 211, 145, 0.1);
        }

        .test-your-knowledge::before, .check-your-knowledge::before {
            background: linear-gradient(45deg, #68d391, #4fd1c7);
        }

        .faq-section {
            background: linear-gradient(135deg, #fffbeb 0%, #fefcf3 100%);
            border-left-color: #fbbf24;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.1);
        }

        .faq-section::before {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
        }

        .stop-and-think {
            background: linear-gradient(135deg, #f3e8ff 0%, #f8f4ff 100%);
            border-left-color: #a78bfa;
            box-shadow: 0 10px 30px rgba(167, 139, 250, 0.1);
        }

        .stop-and-think::before {
            background: linear-gradient(45deg, #a78bfa, #8b5cf6);
        }

        .vocab-section:hover, .why-it-matters:hover, .test-your-knowledge:hover,
        .faq-section:hover, .stop-and-think:hover, .check-your-knowledge:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .vocab-section h3 {
            color: #0ea5e9;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .why-it-matters h3 {
            color: #ec4899;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .test-your-knowledge h3, .check-your-knowledge h3 {
            color: #10b981;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .faq-section h3 {
            color: #d97706;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .stop-and-think h3 {
            color: #8b5cf6;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .vocab-section h4, .test-your-knowledge h4, .check-your-knowledge h4, .faq-section h4 {
            color: #2d3748;
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem 0;
            position: relative;
            z-index: 1;
        }

        .vocab-term {
            color: #0ea5e9;
            font-weight: 600;
        }

        /* Buttons */
        .continue-button, .reveal-button, .check-button {
            display: inline-block;
            padding: 16px 32px;
            margin-top: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50px;
            text-decoration: none;
            cursor: pointer;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .continue-button::before, .reveal-button::before, .check-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .continue-button:hover, .reveal-button:hover, .check-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .continue-button:hover::before, .reveal-button:hover::before, .check-button:hover::before {
            left: 100%;
        }

        .continue-button:active, .reveal-button:active, .check-button:active {
            transform: translateY(-1px);
        }

        /* Hidden state for conditional buttons */
        .continue-button[style*="display: none"] {
            display: none !important;
        }

        /* Ensure all conditional continue buttons match normal button styling exactly when shown */
        #continue-after-interactive:not([style*="display: none"]),
        #continue-after-check-knowledge:not([style*="display: none"]),
        #continue-after-test-knowledge:not([style*="display: none"]) {
            display: inline-block !important;
            width: auto !important;
            max-width: none !important;
            min-width: auto !important;
            padding: 16px 32px !important;
            margin: 30px auto !important;
            box-sizing: border-box !important;
        }

        /* Center ALL continue buttons by making all sections center them */
        section {
            text-align: center;
        }

        /* Reset text alignment for all content except continue buttons */
        section > *:not(.continue-button) {
            text-align: left;
        }

        /* Ensure content boxes also have left alignment */
        .check-your-knowledge,
        .test-your-knowledge,
        .vocab-section,
        .why-it-matters,
        .faq-section,
        .stop-and-think {
            text-align: left;
        }

        /* Smooth appearance for conditional continue buttons */
        .continue-button.show-with-animation {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Multiple Choice */
        .multiple-choice {
            margin: 1.5rem 0;
        }

        .choice-option {
            display: block;
            margin: 1rem 0;
            padding: 1.5rem;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .choice-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .choice-option:hover {
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }

        .choice-option:hover::before {
            opacity: 0.05;
        }

        .choice-option.selected, .choice-option.correct {
            background: linear-gradient(135deg, #eafaf1 0%, #f0fcf4 100%);
            border-color: #68d391;
            color: #2d3748;
        }

        .choice-option.incorrect {
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
            border-color: #f87171;
            color: #2d3748;
        }

        .choice-explanation {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f1f5f9;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.6;
            animation: fadeIn 0.5s ease;
            position: relative;
            z-index: 1;
        }

        /* Spectrum Explorer - keeping the interactive styles but updating colors */
        .spectrum-explorer {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 2rem 0;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            padding: 40px;
        }

        .stage {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .stage-text h3 {
            font-size: 1.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 16px 0;
        }

        .instruction {
            font-size: 1.1rem;
            color: #6b7280;
            margin: 0;
            padding: 16px 24px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            border: 2px dashed rgba(102, 126, 234, 0.3);
        }

        .continue-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .revelation-text h3 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 16px 0;
        }

        .spectrum-point {
            border-radius: 16px;
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
            background: #ffffff;
        }

        .spectrum-point:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .spectrum-point.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .info-panel {
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
        }

        .region-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hook {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .lesson-container {
                padding: 20px 15px;
            }

            section {
                padding: 15px 0;
                margin-bottom: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.75rem;
            }

            p, li {
                font-size: 1rem;
            }



            .continue-button, .reveal-button, .check-button {
                width: 100%;
            text-align: center;
                margin-top: 1.5rem;
            }

            .spectrum-explorer {
                padding: 20px;
            }

            .choice-option {
                padding: 1rem;
            }

            .mark-completed-button {
                padding: 14px 28px;
                font-size: 0.9rem;
                margin: 30px auto 15px auto;
            }
        }

        @media (max-width: 480px) {
            .lesson-container {
                padding: 15px 10px;
            }

            section {
                padding: 10px 0;
            }

            h1 {
                font-size: 1.75rem;
            }

            .vocab-section, .why-it-matters, .test-your-knowledge, 
            .faq-section, .stop-and-think, .check-your-knowledge {
                padding: 1.5rem;
            }

            .mark-completed-button {
                padding: 12px 24px;
                font-size: 0.85rem;
                margin: 25px auto 10px auto;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Accessibility */
        .choice-option:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        .continue-button:focus, .reveal-button:focus, .check-button:focus {
            outline: 2px solid white;
            outline-offset: 2px;
        }

        /* Content positioning */
        .vocab-section *, .why-it-matters *, .test-your-knowledge *, 
        .faq-section *, .stop-and-think *, .check-your-knowledge * {
            position: relative;
            z-index: 1;
        }

        /* Mark as Completed Button */
        .mark-completed-button {
            display: none;
            width: 100%;
            max-width: 400px;
            margin: 40px auto 20px auto;
            padding: 16px 32px;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(72, 187, 120, 0.3);
            text-align: center;
            text-decoration: none;
        }

        .mark-completed-button.show {
            display: block;
        }

        .mark-completed-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(72, 187, 120, 0.4);
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .mark-completed-button:active {
            transform: translateY(0);
        }

        .mark-completed-button.completed {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            box-shadow: 0 4px 20px rgba(148, 163, 184, 0.3);
            cursor: default;
        }

        .mark-completed-button.completed:hover {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            box-shadow: 0 4px 20px rgba(148, 163, 184, 0.3);
            transform: none;
        }

        /* Success Message */
        .lesson-success-message {
            text-align: center;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            margin: 20px auto;
            max-width: 300px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .lesson-success-message.show {
            opacity: 1;
            transform: translateY(0);
        }



        /* Spectrum Explorer specific modern styles */
        .spectrum-explorer {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .prism-svg {
            cursor: pointer;
            user-select: none;
            margin-bottom: 24px;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.1));
            border-radius: 12px;
        }

        .visible-indicator {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 2px solid #667eea;
            color: #667eea;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .scale-label.visible {
            color: #667eea;
            font-weight: 600;
        }

        .exploration-progress {
            text-align: center;
            margin-top: 20px;
            padding: 16px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .progress-text {
            font-size: 0.875rem;
            color: #667eea;
            font-weight: 600;
        }



        /* Keep all other spectrum explorer functionality styles */
        .spectrum-bar {
            position: relative;
            width: 100%;
            height: 60px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        #spectrum-canvas {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }

        .spectrum-points {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0 0 24px 0;
            gap: 8px;
        }

        .spectrum-point {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px 8px;
            cursor: pointer;
            min-width: 80px;
            outline: none;
        }

        .point-icon {
            font-size: 1.5rem;
        }
        
        .point-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }

        .energy-scale {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .energy-label {
            font-size: 0.875rem;
            color: #6b7280;
            white-space: nowrap;
            font-weight: 500;
        }

        .energy-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .panel-header .region-icon {
            color: initial !important;
            background: none !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
        }
        
        /* Fix emoji colors in revelation text and all spectrum content */
        .revelation-text h3,
        .revelation-text,
        .spectrum-point .point-icon,
        h3 {
            color: inherit;
        }
        
        /* Target emojis specifically to prevent color inheritance */
        .revelation-text h3::after,
        .revelation-text h3 *,
        .spectrum-point .point-icon,
        .point-icon {
            background: none !important;
            -webkit-background-clip: initial !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
            color: initial !important;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif !important;
        }
        
        /* Specific fix for Mind = Blown emoji */
        .revelation-text h3 {
            background: none !important;
            -webkit-background-clip: initial !important;
            -webkit-text-fill-color: initial !important;
            background-clip: initial !important;
        }
        
        /* Universal emoji fix */
        span[style*="color: initial"],
        .emoji-fix {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif !important;
            font-style: normal !important;
            font-variant: normal !important;
            text-rendering: auto !important;
            -webkit-font-smoothing: auto !important;
        }
        
        /* Additional emoji protection */
        .revelation-text span,
        .spectrum-point .point-icon {
            display: inline !important;
            text-decoration: none !important;
            font-weight: normal !important;
        }

        .region-icon {
            font-size: 2rem;
            color: initial;
            text-shadow: none;
            filter: none;
            display: inline-block;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        }

        .story-content {
            margin-bottom: 24px;
        }

        .description {
            font-size: 1rem;
            line-height: 1.6;
            margin: 0;
            color: #6b7280;
        }

        .tech-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .spec-item {
            text-align: center;
            padding: 12px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .spec-label {
            display: block;
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: 0.05em;
        }

        .spec-value {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }

        .color-display {
            margin-top: 16px;
        }

        .color-swatch {
            height: 40px;
            border-radius: 12px;
            margin-bottom: 8px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .color-note {
            font-size: 0.875rem;
            color: #6b7280;
            margin: 0;
            font-style: italic;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive design for spectrum explorer */
        @media (min-width: 768px) {
            .exploration-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 32px;
                align-items: start;
            }
            
            .spectrum-points {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .spectrum-point {
                min-width: 100px;
            }
        }

        @media (max-width: 480px) {
            .spectrum-explorer {
                padding: 20px;
            }
            
            .spectrum-points {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
            
            .spectrum-point {
                min-width: auto;
            }
            
            .point-label {
                font-size: 0.7rem;
            }
            
            .tech-specs {
                grid-template-columns: 1fr;
            }
        }
</style>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <div class="lesson-container">
        <section id="section1" class="visible">
            <div class="image-placeholder">
                <img src="images/l23_1.png" alt="...">
        </div>
            <h1>The Artificial Eye: Camera Basics</h1>
            <p>We've seen how the human eye works. Now, let's build a camera from scratch. We'll start with the simplest model possible?a concept known since antiquity?to understand the absolute core principle of image formation. This is the Pinhole Camera, and its elegant geometry is the foundation of all photography and computer vision.</p>
            <div class="continue-button" onclick="showNextSection(2)">Continue</div>
        </section>

        <section id="section2">
            <h2>The Camera Obscura</h2>
            <p>Imagine a completely dark room with one tiny hole in a window shade. If you look at the wall opposite the hole, you'll see a faint, upside-down image of the world outside. This is a 'camera obscura', or pinhole camera. It works because light travels in straight lines.</p>
            <div class="continue-button" onclick="showNextSection(3)">Continue</div>
        </section>

        <section id="section3">
            <p>Only a very small number of light rays from any single point in the outside world can pass through the tiny pinhole. These rays continue in a straight line until they hit the back wall, forming a sharp, point-for-point inverted projection of the scene.</p>
            <div class="image-placeholder">
                <img src="images/l23_2.png" alt="...">
        </div>
            <div class="continue-button" onclick="showNextSection(4)">Continue</div>
        </section>

        <section id="section4">
            <h2>The Maths of Projection</h2>
            <p>This elegant principle can be described with some simple mathematics. Our goal is to figure out exactly where a point in the 3D world will land on our 2D image plane.</p>
            <div class="continue-button" onclick="showNextSection(5)">Continue</div>
        </section>

        <section id="section5">
            <p>Let's set up a coordinate system. A point in the world has coordinates (X, Y, Z). The image plane is at a distance 'f' from the pinhole. This 'f' is called the <strong>focal length</strong>. The point on our image has coordinates (x', y'). Because the image is inverted, the relationship is based on similar triangles.</p>
            <div class="math-content">
                <div class="step-by-step">
                    <h3>Step-by-Step: The Pinhole Projection Equations</h3>

                    <div class="step">
                        <div class="step-title">Step 1: The Setup</div>
                        <p>Look at the side view of our camera. We have two triangles: a large one outside the camera formed by the object's height (Y) and its distance (Z), and a small one inside the camera formed by the image height (y') and the focal length (f).</p>
                        <div class="math-equation">Y and Z (World), y' and f (Image)</div>
                    </div>

                    <div class="step">
                        <div class="step-title">Step 2: Similar Triangles</div>
                        <p>These two triangles are similar, which means the ratio of their corresponding sides is equal. The height of the image (y') relative to the focal length (f) is the same as the height of the object (Y) relative to its distance (Z).</p>
                        <div class="math-equation">$$\frac{y'}{f} = \frac{Y}{Z}$$</div>
                    </div>

                    <div class="step">
                        <div class="step-title">Step 3: Account for Inversion</div>
                        <p>Wait! Our image is upside-down. So, the image coordinate y' is actually negative. Let's fix our equation. To make y' negative, we can write the equation like this, which is equivalent.</p>
                        <div class="math-equation">$$\frac{y'}{-f} = \frac{Y}{Z}$$</div>
                    </div>

                    <div class="step">
                        <div class="step-title">Step 4: The Final Equations</div>
                        <p>Now, we just solve for our image coordinates, x' and y'. We do the exact same thing for the X coordinate. This gives us the fundamental projection equations.</p>
                        <div class="math-equation">$$y' = -f \frac{Y}{Z} \quad \text{and} \quad x' = -f \frac{X}{Z}$$</div>
                    </div>
                </div>

                <div class="example">
                    <h4>Example Calculation</h4>
                    <p><strong>Problem:</strong> A camera has a focal length <code>f = 25mm</code>. You're taking a photo of a person who is 1800mm tall (Y) and standing 5000mm away (Z). How tall will their image be on the sensor (y')?</p>
                    <p><strong>Calculation:</strong> y' = -25mm * (1800mm / 5000mm) = -25mm * 0.36 = -9mm</p>
                    <p><strong>Result:</strong> The person's image on the sensor will be 9mm tall and upside down.</p>
                </div>
            </div>
            <div class="continue-button" onclick="showNextSection(6)">Continue</div>
        </section>

        <section id="section6">
            <h2>The Problem with Pinholes</h2>
            <p>The pinhole camera is simple and beautiful, but it has a major flaw: the trade-off between brightness and sharpness.</p>
            <ul>
                <li>A <strong>tiny pinhole</strong> creates a very sharp image, but lets in very little light, so the image is incredibly dim.</li>
                <li>A <strong>larger pinhole</strong> lets in more light for a brighter image, but rays from the same point in the scene can now hit multiple spots on the image plane, creating a blurry mess.</li>
            </ul>
            <div class="image-placeholder">
                [Image Placeholder: A visual comparison (based on Figure 2.11). The left side shows a large pinhole with multiple light rays from a single point on an object spreading out to create a blurry spot on the image plane. The right side shows a lens gathering all those rays and focusing them back to a single, sharp point.]
            </div>
            <div class="continue-button" onclick="showNextSection(7)">Continue</div>
        </section>

        <section id="section7">
            <p>To solve this, we use a <strong>lens</strong>. A lens can have a large opening to gather lots of light, but it uses the principles of refraction to bend all those light rays back to a single, sharp point. This gives us the best of both worlds: a bright AND sharp image.</p>
            <div class="continue-button" onclick="showNextSection(8)">Continue</div>
        </section>

        <section id="section8">
            <h2>Controlling the Scene: Aperture and Depth of Field</h2>
            <p>Modern cameras with lenses have an adjustable opening called an <strong>aperture</strong>, which works just like the iris in your eye. But changing its size does more than just control brightness. It also controls the <strong>Depth of Field (DoF)</strong>?the range of distances in your scene that appear acceptably sharp.</p>
            <div class="continue-button" onclick="showNextSection(9)">Continue</div>
        </section>

        <section id="section9">
            <p>Think of it this way: a small aperture acts more like a pinhole, forcing light to travel in straighter lines, which brings more of the scene (both near and far) into focus. A large aperture is less strict, and only the exact distance you're focused on will be perfectly sharp. Let's see this in action.</p>
            <div class="dof-sim" aria-live="polite">
                <div id="dofScene" class="dof-scene" role="img" aria-label="Photo scene with flower, tree, and mountains. Blur changes with aperture.">
                    <div class="layer mountains">??</div>
                    <div class="layer tree">??</div>
                    <div class="layer flower">??</div>
                </div>
                <div class="dof-controls">
                    <label for="apertureSlider">Aperture <span id="apertureLabel">f/2.8</span></label>
                    <input id="apertureSlider" type="range" min="0" max="7" step="1" value="1" aria-valuetext="Aperture f/2.8" />
                    <div class="dof-stops" aria-hidden="true">
                        <span>f/1.8</span>
                        <span>f/2.8</span>
                        <span>f/4</span>
                        <span>f/5.6</span>
                        <span>f/8</span>
                        <span>f/11</span>
                        <span>f/16</span>
                        <span>f/22</span>
                    </div>
                    <div class="dof-meter">
                        <div class="meter-bar"><div class="meter-fill" id="meterFill"></div></div>
                        <div class="meter-text"><span id="evLabel">0 EV</span> brightness</div>
                    </div>
                    <div class="dof-helper" id="dofHelper">Shallow Depth of Field ? great for portraits!</div>
                </div>
            </div>
            <div class="why-it-matters">
                <h3>Why It Matters</h3>
                <p>The pinhole equations are the mathematical heart of all 3D-to-2D projection in computer graphics and computer vision. And understanding aperture and Depth of Field is key to both artistic photography and practical computer vision tasks where you might need the entire scene to be in focus.</p>
            </div>
            <div class="vocab-section">
                <h3>Build Your Vocab</h3>
                <h4 class="vocab-term">Pinhole Camera</h4>
                <p>The simplest camera model, explaining image formation via geometric projection. It forms an inverted image.</p>
                <h4 class="vocab-term">Focal Length (f)</h4>
                <p>The distance from the center of the lens (or pinhole) to the image plane. It affects the field of view.</p>
                <h4 class="vocab-term">Depth of Field (DoF)</h4>
                <p>The range of distances in a scene that appear acceptably sharp in a photograph.</p>
            </div>
            <div class="continue-button" id="continue-after-interactive" onclick="showNextSection(10)" style="display: none;">Continue</div>
        </section>

        <section id="section10">
            <div class="faq-section">
                <h3>Frequently Asked Questions</h3>
                <h4>Does the Z-value (depth) get stored in the final image?</h4>
                <p>No, and that's a crucial point! In this projection process, all the 3D depth information from the Z coordinate is lost. The 3D world is collapsed onto a flat 2D plane. A major challenge in computer vision is trying to infer that lost depth information back from the 2D image.</p>
            </div>
            <div class="continue-button" onclick="showNextSection(11)">Continue</div>
        </section>

        <section id="section11">
            <div class="test-your-knowledge">
                <h3>Test Your Knowledge</h3>
                <h4>You want to take a landscape photo where everything from the nearby rocks to the distant mountains is sharp. What kind of aperture setting should you use?</h4>
                <div class="multiple-choice">
                    <div class="choice-option" onclick="selectChoice(this, false, 'A large aperture (e.g., f/2.8)', 'A large aperture creates a shallow depth of field, which would make either the rocks or the mountains blurry. This is better for portraits.')">
                        A large aperture (e.g., f/2.8)
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, true, 'A small aperture (e.g., f/16)', 'Correct! A small aperture creates a deep depth of field, ensuring that a wide range of distances from near to far are all in focus.')">
                        A small aperture (e.g., f/16)
                    </div>
                    <div class="choice-option" onclick="selectChoice(this, false, 'The aperture size doesn\'t affect the sharpness of different distances.', 'It absolutely does! This is the core concept of Depth of Field.')">
                        The aperture size doesn't affect the sharpness of different distances.
                    </div>
                </div>
            </div>
            <div class="continue-button" id="continue-after-test-knowledge" onclick="showNextSection(12)" style="display: none;">Continue</div>
        </section>

        <section id="section12">
            <h2>Review and Reflect</h2>

            <p>Great job building our first camera! We've laid the physical and mathematical groundwork for how any camera, from the most ancient to the most modern, forms an image. Let's review:</p>
            <ul>
                <li><strong>Pinhole Camera:</strong> The simplest model, forming an inverted image based on light traveling in straight lines. Its geometry is described by the <strong>projection equations</strong>.</li>
                <li><strong>The Role of a Lens:</strong> Lenses solve the pinhole's brightness vs. sharpness trade-off, allowing for images that are both bright and sharp.</li>
                <li><strong>Aperture & DoF:</strong> The aperture controls both the amount of light and the <strong>Depth of Field</strong>, giving photographers and roboticists control over what is in focus.</li>
            </ul>
            <p>We've successfully formed a sharp, bright image on a plane. But how do we *record* it and turn it into a digital file? In the next lesson, we'll dive into the heart of the digital camera: the sensor.</p>
          
        </section>

        <!-- Mark as Completed Button -->
        <button id="markCompletedBtn" class="mark-completed-button" onclick="toggleCompleted()"> &#10003; Mark as Completed
        </button>

    </div>

    <script>
        let currentSection = 1;
        const totalSections = 12;

        // Initialize
        updateProgress();

        // Show the mark as completed button if already on the final section
        if (currentSection === totalSections) {
            const completedButton = document.getElementById('markCompletedBtn');
            if (completedButton) {
                completedButton.classList.add('show');
            }
        }

        function showNextSection(nextSectionId) {
            const currentSectionElement = document.getElementById(`section${currentSection}`);
            const nextSectionElement = document.getElementById(`section${nextSectionId}`);
            const currentButton = event.target;

            if (!nextSectionElement) return;

            // Hide the continue button
            currentButton.style.display = 'none';

            // Show next section with smooth animation
            nextSectionElement.classList.add('visible', 'animate-in');

            // Update current section
            currentSection = nextSectionId;
            updateProgress();

            // Show the mark as completed button when reaching the final section
            if (currentSection === totalSections) {
                const completedButton = document.getElementById('markCompletedBtn');
                if (completedButton) {
                    completedButton.classList.add('show');
                }
            }

            // Smooth scroll to new section
            setTimeout(() => {
                nextSectionElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);
        }

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const progress = (currentSection / totalSections) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function selectChoice(element, isCorrect, optionText, explanation) {
            // Remove previous selections
            const choices = element.parentNode.querySelectorAll('.choice-option');
            choices.forEach(choice => {
                choice.classList.remove('selected', 'correct', 'incorrect');
                const existingExplanation = choice.querySelector('.choice-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                }
            });

            // Mark the selected choice
            element.classList.add('selected');
            element.classList.add(isCorrect ? 'correct' : 'incorrect');

            // Add explanation with animation
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'choice-explanation animate-in';
            explanationDiv.style.display = 'block';
            explanationDiv.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Not quite.'}</strong> ${explanation}`;
            element.appendChild(explanationDiv);

            // Show correct answer if wrong choice was selected
            if (!isCorrect) {
                choices.forEach(choice => {
                    if (choice !== element) {
                        const choiceText = choice.textContent.trim();
                        if (choiceText.includes('small aperture') || choiceText.includes('f/16')) {
                            choice.classList.add('correct');
                            const correctExplanation = document.createElement('div');
                            correctExplanation.className = 'choice-explanation animate-in';
                            correctExplanation.style.display = 'block';
                            if (choiceText.includes('small aperture')) {
                                correctExplanation.innerHTML = '<strong>This is the correct answer:</strong> Correct! A small aperture creates a deep depth of field, ensuring that a wide range of distances from near to far are all in focus.';
                            }
                            choice.appendChild(correctExplanation);
                        }
                    }
                });
            }

            // Show continue button after answering
            const parentSection = element.closest('section');
            if (parentSection) {
                const sectionId = parentSection.id;
                let continueButtonId = null;

                if (sectionId === 'section11') {
                    continueButtonId = 'continue-after-test-knowledge';
                }

                if (continueButtonId) {
                    const continueButton = document.getElementById(continueButtonId);
                    if (continueButton && continueButton.style.display === 'none') {
                        setTimeout(() => {
                            continueButton.style.display = 'block';
                            continueButton.classList.add('show-with-animation');
                        }, 1000);
                    }
                }
            }
        }

        // Depth of Field Simulator
        (function initDoFSimulator() {
            const fStops = [1.8, 2.8, 4, 5.6, 8, 11, 16, 22];
            const referenceN = 2.8;
            const focalLengthMm = 50; // 50mm lens
            const circleOfConfusionMm = 0.03; // full-frame CoC
            const focusDistanceMm = 1000; // focus at 1m (flower)
            const layerDistancesMm = {
                flower: 1000,     // 1 m
                tree: 5000,       // 5 m
                mountains: 100000 // 100 m
            };

            const scene = document.getElementById('dofScene');
            const slider = document.getElementById('apertureSlider');
            const label = document.getElementById('apertureLabel');
            const evLabel = document.getElementById('evLabel');
            const meterFill = document.getElementById('meterFill');
            const helper = document.getElementById('dofHelper');
            const continueBtn = document.getElementById('continue-after-interactive');

            if (!scene || !slider || !label || !evLabel || !meterFill || !helper) return;

            const layerElems = {
                flower: scene.querySelector('.layer.flower'),
                tree: scene.querySelector('.layer.tree'),
                mountains: scene.querySelector('.layer.mountains')
            };

            function computeDoFLimits(N) {
                const H = (focalLengthMm * focalLengthMm) / (N * circleOfConfusionMm) + focalLengthMm; // hyperfocal (mm)
                const s = focusDistanceMm; // (mm)
                const Dn = (H * s) / (H + (s - focalLengthMm));
                let Df = Infinity;
                if (s < H) {
                    Df = (H * s) / (H - (s - focalLengthMm));
                }
                return { Dn, Df };
            }

            function blurForDistance(distanceMm, Dn, Df, N) {
                // In-DoF is sharp
                if (distanceMm >= Dn && (isFinite(Df) ? distanceMm <= Df : true)) return 0;
                // How far outside DoF (mm)
                const outside = distanceMm < Dn ? (Dn - distanceMm) : (isFinite(Df) ? (distanceMm - Df) : (distanceMm - focusDistanceMm));
                // Normalize outside distance to [0..1] with soft knee
                const distanceNormalized = outside / (outside + focusDistanceMm * 3);
                // Dynamic cap reduces blur at narrow apertures (visible change)
                const t = Math.min(1, Math.max(0, (N - 1.8) / (22 - 1.8))); // 0 at f/1.8, 1 at f/22
                const maxBlurForN = (1 - t) * 16 + t * 2; // 16px ? 2px
                return distanceNormalized * maxBlurForN;
            }

            function setLayerBlur(N) {
                const { Dn, Df } = computeDoFLimits(N);
                const bFlower = blurForDistance(layerDistancesMm.flower, Dn, Df, N);
                const bTree = blurForDistance(layerDistancesMm.tree, Dn, Df, N);
                const bMountains = blurForDistance(layerDistancesMm.mountains, Dn, Df, N);
                if (layerElems.flower) layerElems.flower.style.filter = `blur(${bFlower.toFixed(1)}px)`;
                if (layerElems.tree) layerElems.tree.style.filter = `blur(${bTree.toFixed(1)}px)`;
                if (layerElems.mountains) layerElems.mountains.style.filter = `blur(${bMountains.toFixed(1)}px)`;
            }

            function setBrightnessAndMeter(N) {
                // Relative brightness compared to referenceN
                const ratio = (referenceN / N) * (referenceN / N); // (N0/N)^2
                const clamped = Math.max(0.35, Math.min(1, ratio));
                scene.style.filter = `brightness(${clamped})`;

                const evDelta = 2 * Math.log2(N / referenceN);
                const evText = `${evDelta.toFixed(1)} EV`;
                evLabel.textContent = evText;
                meterFill.style.width = `${clamped * 100}%`;
            }

            function setHelperText(N) {
                if (N <= 2.8) {
                    helper.textContent = 'Shallow Depth of Field ? great for portraits!';
                } else if (N >= 11) {
                    helper.textContent = 'Deep Depth of Field ? great for landscapes!';
                } else {
                    helper.textContent = 'Balanced Depth of Field ? foreground and background moderately sharp.';
                }
            }

            function updateFromSlider(userChanged) {
                const index = parseInt(slider.value, 10);
                const N = fStops[index] || referenceN;
                label.textContent = `f/${N}`;
                slider.setAttribute('aria-valuetext', `Aperture f/${N}`);
                setLayerBlur(N);
                setBrightnessAndMeter(N);
                setHelperText(N);

                if (userChanged && continueBtn && continueBtn.style.display === 'none') {
                    // reveal continue
                    setTimeout(() => {
                        continueBtn.style.display = 'inline-block';
                        continueBtn.classList.add('show-with-animation');
                    }, 250);
                }
            }

            slider.addEventListener('input', () => updateFromSlider(true));

            // Initial render
            updateFromSlider(false);
        })();

        // Keyboard Support
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowRight' || event.key === ' ') {
                const continueButton = document.querySelector(`#section${currentSection} .continue-button`);
                if (continueButton && continueButton.style.display !== 'none') {
                    event.preventDefault();
                    continueButton.click();
                }
            }
        });

        // Smooth scrolling
        document.documentElement.style.scrollBehavior = 'smooth';

        // Mark as Completed functionality
        function toggleCompleted() {
            const button = document.getElementById('markCompletedBtn');
            if (!button) return;

            const isCompleted = button.classList.contains('completed');

            if (!isCompleted) {
                // Try to use platform's ProgressTracker system
                try {
                    if (window.parent && window.parent.ProgressTracker) {
                        let courseId = 'computer-vision';
                        let pathId = 'perception-systems';
                        let moduleId = 'cv-artificial-eye';
                        let lessonId = 'cv-l4-artificial-eye';

                        if (window.parent.currentRoute) {
                            const route = window.parent.currentRoute;
                            if (route.courseId) courseId = route.courseId;
                            if (route.pathId) pathId = route.pathId;
                            if (route.moduleId) moduleId = route.moduleId;
                            if (route.lessonId) lessonId = route.lessonId;
                        }

                        const urlParams = new URLSearchParams(window.location.search);
                        if (urlParams.get('course')) courseId = urlParams.get('course');
                        if (urlParams.get('path')) pathId = urlParams.get('path');
                        if (urlParams.get('module')) moduleId = urlParams.get('module');
                        if (urlParams.get('lesson')) lessonId = urlParams.get('lesson');

                        window.parent.ProgressTracker.markLessonCompleted(courseId, pathId, moduleId, lessonId);
                    }
                } catch (error) {
                    console.error('Error with ProgressTracker:', error);
                }

                // Update button appearance
                button.classList.add('completed');
                button.innerHTML = '&#9989; Completed!';

                // Trigger celebration
                triggerCelebration();

                // Fallback localStorage for direct access
                localStorage.setItem('lesson_cv-ch02-l4_completed', 'true');
            }
        }

        function triggerCelebration() {
            // Create confetti
            createConfetti();

            // Show success message
            showSuccessMessage();
        }

        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);

            const confettiEmojis = ['??', '??', '?', '??', '??', '??', '??', '??', '??', '??'];
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd', '#98d8c8', '#f7dc6f'];

            // Create 50 confetti pieces
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';

                    // Random emoji or colored shape
                    if (Math.random() > 0.6) {
                        confetti.textContent = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
                    } else {
                        confetti.innerHTML = '?';
                        confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                    }

                    // Random horizontal position
                    confetti.style.left = Math.random() * 100 + '%';

                    // Random animation delay
                    confetti.style.animationDelay = Math.random() * 2 + 's';

                    confettiContainer.appendChild(confetti);
                }, i * 50);
            }

            // Remove confetti after animation
            setTimeout(() => {
                if (confettiContainer.parentNode) {
                    confettiContainer.parentNode.removeChild(confettiContainer);
                }
            }, 5000);
        }

        function showSuccessMessage() {
            const successMessage = document.createElement('div');
            successMessage.className = 'success-message';
            successMessage.innerHTML = '?? Lesson Completed! Great Job! ??';
            document.body.appendChild(successMessage);

            // Remove success message after animation
            setTimeout(() => {
                if (successMessage.parentNode) {
                    successMessage.parentNode.removeChild(successMessage);
                }
            }, 2500);
        }

        // Load completion status on page load
        window.addEventListener('load', function() {
            const button = document.getElementById('markCompletedBtn');
            if (!button) return;

            // Check platform ProgressTracker first
            if (window.parent && window.parent.ProgressTracker) {
                let courseId = 'computer-vision';
                let pathId = 'perception-systems';
                let moduleId = 'cv-artificial-eye';
                let lessonId = 'cv-l4-artificial-eye';

                if (window.parent.currentRoute) {
                    const route = window.parent.currentRoute;
                    if (route.courseId) courseId = route.courseId;
                    if (route.pathId) pathId = route.pathId;
                    if (route.moduleId) moduleId = route.moduleId;
                    if (route.lessonId) lessonId = route.lessonId;
                }

                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('course')) courseId = urlParams.get('course');
                if (urlParams.get('path')) pathId = urlParams.get('path');
                if (urlParams.get('module')) moduleId = urlParams.get('module');
                if (urlParams.get('lesson')) lessonId = urlParams.get('lesson');

                const progress = window.parent.ProgressTracker.getLessonProgress(courseId, pathId, moduleId, lessonId);

                if (progress.state === window.parent.ProgressTracker.STATES.COMPLETED) {
                    button.classList.add('completed');
                    button.innerHTML = '&#9989; Completed!';
                    return;
                }
            }

            // Fallback to localStorage
            const isCompleted = localStorage.getItem('lesson_cv-ch02-l4_completed') === 'true';
            if (isCompleted) {
                button.classList.add('completed');
                button.innerHTML = '&#9989; Completed!';
            }
        });
    </script>
</body>
</html>

